
## ä¸€ã€æ˜¯ä»€ä¹ˆ


## äºŒã€å‡†å¤‡å·¥ä½œ

### 2.1 hello world

### 2.2 å¦‚æœè°ƒç”¨

### 2.3 å¼€å‘è€…å·¥å…·ä½¿ç”¨

## ä¸‰ã€è®²è§£

###
















## æ˜¯ä»€ä¹ˆ

- ä¸ºä»€ä¹ˆå« graphql
- GraphQLæ¥è‡ªFacebook
- å—¯ï¼Œå’ŒSQLä¸€æ ·ï¼ŒGraphQLæ˜¯ä¸€é—¨æŸ¥è¯¢è¯­è¨€, GraphQL æ˜¯ä¸€ç§æè¿°è¯·æ±‚æ•°æ®æ–¹æ³•çš„è¯­æ³•
- åŒæ ·å’ŒSQLä¸€æ ·çš„æ˜¯ï¼ŒGraphQLä¹Ÿæ˜¯ä¸€å¥—è§„èŒƒï¼Œå°±åƒMySQLæ˜¯SQLçš„ä¸€å¥—å®ç°ä¸€æ ·ï¼ŒApollo, Relay...ä¹Ÿæ˜¯GraphQLè§„èŒƒçš„å®ç°
- ä¸SQLä¸åŒçš„æ˜¯ï¼ŒSQLçš„æ•°æ®æºæ˜¯æ•°æ®åº“ï¼Œè€ŒGraphQLçš„æ•°æ®æºå¯ä»¥æ˜¯å„ç§å„æ ·çš„REST APIï¼Œå¯ä»¥æ˜¯å„ç§æœåŠ¡/å¾®æœåŠ¡ï¼Œç”šè‡³å¯ä»¥æ˜¯æ•°æ®åº“
- GraphQLè§„èŒƒäº2015å¹´å¼€æº
- é‚£ä¹ˆä¸ºä»€ä¹ˆå« Graphå‘¢ï¼Ÿ
- GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€
- GraphQL æ˜¯ä¸€ç§é¢å‘æ•°æ®çš„ API æŸ¥è¯¢é£æ ¼
- å‡ºç”Ÿ: 2015, çˆ¶äº²: Facebook
- (å·²å¼€æº)2018 å¹´ 11 æœˆ 7 æ—¥ï¼ŒFacebook å°† GraphQL é¡¹ç›®è½¬ç§»åˆ°æ–°æˆç«‹çš„ GraphQL åŸºé‡‘ä¼š
- ä¼ ç»Ÿçš„ API æ‹¿åˆ°çš„æ˜¯å‰åç«¯çº¦å®šå¥½çš„æ•°æ®æ ¼å¼ï¼ŒGraphQL å¯¹ API ä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œæ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®© API æ›´å®¹æ˜“åœ°éšç€æ—¶é—´æ¨ç§»è€Œæ¼”è¿›ï¼Œè¿˜èƒ½ç”¨äºæ„å»ºå¼ºå¤§çš„å¼€å‘è€…å·¥å…·
- è®²æ•…äº‹: é—®é¢˜, è§£å†³æ–¹æ¡ˆ https://juejin.cn/post/6844903475420069902
- åç§°ä¸­çš„ â€œGraphâ€ æ˜¯æ¥è‡ªäº GraphQL ä½¿ç”¨å­—æ®µä¸å­å­—æ®µæ¥éå†ä½ çš„ API å›¾è°±ï¼›â€œQLâ€ çš„æ„æ€æ˜¯â€œæŸ¥è¯¢è¯­è¨€â€ï¼ˆquery languageï¼‰ã€‚

## æ¦‚è¿°

- ç†è®ºä¸Šï¼Œä¸€ä¸ª GraphQL API ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šschemaï¼ˆç±»å‹ï¼‰ï¼Œqueriesï¼ˆæŸ¥è¯¢ï¼‰ ä»¥åŠ resolversï¼ˆè§£æå™¨ï¼‰

ä¸ºä»€ä¹ˆè¦å‡ºç° QL, QL ç®€å•ä¸¾ä¸ªä¾‹å­ï¼Ÿï¼Ÿç»™ä¸ªå›¾

## è§£å†³äº†ä»€ä¹ˆ

- å®ƒå…è®¸å®¢æˆ·ç«¯æŒ‡å®šå…·ä½“æ‰€éœ€çš„æ•°æ®ã€‚
- å®ƒè®©ä»å¤šä¸ªæ•°æ®æºæ±‡æ€»å–æ•°æ®å˜å¾—æ›´ç®€å•ã€‚
- å®ƒä½¿ç”¨äº†ç±»å‹ç³»ç»Ÿæ¥æè¿°æ•°æ®ã€‚
- APIå­—æ®µçš„å®šåˆ¶åŒ–ï¼ŒæŒ‰éœ€å–å­—æ®µ
- APIçš„èšåˆï¼Œä¸€æ¬¡è¯·æ±‚æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®
- åç«¯ä¸å†éœ€è¦ç»´æŠ¤æ¥å£çš„ç‰ˆæœ¬å·äº†(éšæ„æ·»åŠ ã€é€šè¿‡ä¿®é¥°ç¬¦æ ‡è®°ä¸ºåºŸå¼ƒ)
- å®Œå¤‡çš„ç±»å‹æ ¡éªŒæœºåˆ¶ï¼Œæä¾›äº†æ›´å¥å£®çš„æ¥å£
- ç²¾å‡†ã€å¯é¢„æµ‹åœ°è¿”å›æ•°æ®: REST åç«¯ç»™ä½ ä»€ä¹ˆæˆ‘å°±è¦ä»€ä¹ˆ, å°¤å…¶æ˜¯å†å²æ‚ ä¹…çš„æ¥å£, ä¼ ç»Ÿçš„ RESTful æ¥å£, åç«¯ä¼ é€’å¤šå°‘å­—æ®µ, å‰ç«¯å°±å¾—æ¥æ”¶å¤šå°‘å­—æ®µ. å› æ­¤, æœ‰æ—¶å€™å‰ç«¯åªéœ€è¦å‡ ä¸ªå­—æ®µ, ä½†åç«¯è¿”å›ä¸€å¤§ä¸²(å°¤å…¶æ˜¯å†å²æ‚ ä¹…çš„æ¥å£), è¿™ä¸ä½†å¯¹å‰ç«¯ç­›é€‰æ¥å£å­—æ®µå¢åŠ äº†éš¾åº¦, è¿˜å¯èƒ½ä¼šé€ æˆæ½œåœ¨çš„æ€§èƒ½é—®é¢˜. è€Œ GraphQL ä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®, è€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™, å¹¶ä¸” GraphQL ç­›é€‰è¿™äº›å­—æ®µçš„è¿‡ç¨‹ä¸ä¾èµ–äºæœåŠ¡å™¨, è€Œæ˜¯å®ƒè‡ªå·±è¿è¡Œæ—¶
- åªè¯·æ±‚ä¸€ä¸ªæ¥å£
- GraphQL ä¸ä¾èµ–äºä»»ä½•ç¼–ç¨‹è¯­è¨€, ä»–åªæ˜¯ä¸€ä¸ªè§„èŒƒ, è‡³äºä½¿ç”¨ä»€ä¹ˆè¯­è¨€ã€å¦‚ä½•å®ç°å°±å®Œå…¨è‡ªç”±
- å¦‚æœä½¿ç”¨ GraphQLï¼Œé‚£ä¹ˆåç«¯å°†ä¸å†äº§å‡º APIï¼Œè€Œæ˜¯å°† Controller å±‚ç»´æŠ¤ä¸º Resolverï¼Œå’Œå‰ç«¯çº¦å®šä¸€å¥— Schemaï¼Œè¿™ä¸ª Schema å°†ç”¨æ¥ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œå‰ç«¯ç›´æ¥é€šè¿‡ Schema æˆ–ç”Ÿæˆçš„æ¥å£æ–‡æ¡£æ¥è¿›è¡Œè‡ªå·±æœŸæœ›çš„è¯·æ±‚
- æ­£å¦‚å°¤é›¨æºªæ‰€è¯´ï¼Œä¸ºä»€ä¹ˆ GraphQL ä¸¤ä¸‰å¹´å‰æ²¡æœ‰å¹¿æ³›ä½¿ç”¨èµ·æ¥å‘¢ï¼Œå¯èƒ½æœ‰ä¸‹é¢ä¸¤ä¸ªåŸå› ï¼š

> GraphQL çš„ field resolve å¦‚æœæŒ‰ç…§ naive çš„æ–¹å¼æ¥å†™ï¼Œæ¯ä¸€ä¸ª field éƒ½å¯¹æ•°æ®åº“ç›´æ¥è·‘ä¸€ä¸ª queryï¼Œä¼šäº§ç”Ÿå¤§é‡å†—ä½™ queryï¼Œè™½ç„¶ç½‘ç»œå±‚é¢çš„è¯·æ±‚æ•°è¢«ä¼˜åŒ–äº†ï¼Œä½†æ•°æ®åº“æŸ¥è¯¢å¯èƒ½ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œè¿™é‡Œé¢æœ‰å¾ˆå¤§çš„ä¼˜åŒ–ç©ºé—´ï¼Œä½†å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“åšã€‚FB æœ¬èº«æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºä»–ä»¬å†…éƒ¨æ•°æ®åº“è¿™ä¸€å±‚ä¹Ÿæ˜¯æŠ½è±¡æ‰çš„ï¼Œå†™ GraphQL æ¥å£çš„äººä¸éœ€è¦é¡¾è™‘ query ä¼˜åŒ–çš„é—®é¢˜ã€‚
GraphQL çš„åˆ©å¥½ä¸»è¦æ˜¯åœ¨äºå‰ç«¯çš„å¼€å‘æ•ˆç‡ï¼Œä½†è½åœ°å´éœ€è¦æœåŠ¡ç«¯çš„å…¨åŠ›é…åˆã€‚å¦‚æœæ˜¯å°å…¬å¸æˆ–è€…æ•´ä¸ªå…¬å¸éƒ½æ˜¯å…¨æ ˆï¼Œé‚£å¯èƒ½å¯ä»¥åšï¼Œä½†åœ¨å¾ˆå¤šå‰åç«¯åˆ†å·¥æ¯”è¾ƒæ˜ç¡®çš„å›¢é˜Ÿé‡Œï¼Œè¦æ¨åŠ¨ GraphQL è¿˜æ˜¯ä¼šé‡åˆ°å„ç§åä½œä¸Šçš„é˜»åŠ›ã€‚

## å‡ ä¸ªé‡è¦æ¦‚å¿µ

1. æ“ä½œç±»å‹: æè¿°å®¢æˆ·ç«¯å½“å‰å¸Œæœ›è¿›è¡Œæ€ä¹ˆæ ·çš„æ“ä½œ

query æŸ¥è¯¢ï¼šè·å–æ•°æ®ï¼Œæ¯”å¦‚æŸ¥æ‰¾ï¼ŒCRUD ä¸­çš„ R
mutation å˜æ›´ï¼šå¯¹æ•°æ®è¿›è¡Œå˜æ›´ï¼Œæ¯”å¦‚å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼ŒCRUD ä¸­çš„ CUD
substription è®¢é˜…ï¼šå½“æ•°æ®å‘ç”Ÿæ›´æ”¹ï¼Œè¿›è¡Œæ¶ˆæ¯æ¨é€

2. å¯¹è±¡ç±»å‹å’Œæ ‡é‡ç±»å‹

å¦‚æœä¸€ä¸ª GraphQL æœåŠ¡æ¥å—åˆ°äº†ä¸€ä¸ª queryï¼Œé‚£ä¹ˆè¿™ä¸ª query å°†ä» Root Query å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹è±¡ç±»å‹ï¼ˆObject Typeï¼‰æ—¶åˆ™ä½¿ç”¨å®ƒçš„è§£æå‡½æ•° Resolver æ¥è·å–å†…å®¹ï¼Œå¦‚æœè¿”å›çš„æ˜¯å¯¹è±¡ç±»å‹åˆ™ç»§ç»­ä½¿ç”¨è§£æå‡½æ•°è·å–å†…å®¹ï¼Œå¦‚æœè¿”å›çš„æ˜¯æ ‡é‡ç±»å‹ï¼ˆScalar Typeï¼‰åˆ™ç»“æŸè·å–ï¼Œç›´åˆ°æ‰¾åˆ°æœ€åä¸€ä¸ªæ ‡é‡ç±»å‹ã€‚

å¯¹è±¡ç±»å‹ï¼šç”¨æˆ·åœ¨ schema ä¸­å®šä¹‰çš„ type
æ ‡é‡ç±»å‹ï¼šGraphQL ä¸­å†…ç½®æœ‰ä¸€äº›æ ‡é‡ç±»å‹ Stringã€Intã€Floatã€Booleanã€IDï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æ ‡é‡ç±»å‹

3. æ¨¡å¼ Schema

å®ƒå®šä¹‰äº†å­—æ®µçš„ç±»å‹ã€æ•°æ®çš„ç»“æ„ï¼Œæè¿°äº†æ¥å£æ•°æ®è¯·æ±‚çš„è§„åˆ™ï¼Œå½“æˆ‘ä»¬è¿›è¡Œä¸€äº›é”™è¯¯çš„æŸ¥è¯¢çš„æ—¶å€™ GraphQL å¼•æ“ä¼šè´Ÿè´£å‘Šè¯‰æˆ‘ä»¬å“ªé‡Œæœ‰é—®é¢˜ï¼Œå’Œè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¯¹å¼€å‘è°ƒè¯•ååˆ†å‹å¥½ã€‚
Schema ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å¼ºç±»å‹æ¨¡å¼è¯­æ³•ï¼Œç§°ä¸ºæ¨¡å¼æè¿°è¯­è¨€ï¼ˆSchema Definition Language, SDLï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªçœŸå®çš„ä¾‹å­æ¥å±•ç¤ºä¸€ä¸‹ä¸€ä¸ªçœŸå®çš„ Schema æ–‡ä»¶æ˜¯æ€ä¹ˆç”¨ SDL ç¼–å†™çš„ï¼š

è¿™ä¸ªç®€å•çš„ Schema æ–‡ä»¶ä» Queryã€Mutationã€Subscription å…¥å£å¼€å§‹å®šä¹‰äº†å„ä¸ªå¯¹è±¡ç±»å‹æˆ–æ ‡é‡ç±»å‹ï¼Œè¿™äº›å­—æ®µçš„ç±»å‹ä¹Ÿå¯èƒ½æ˜¯å…¶ä»–çš„å¯¹è±¡ç±»å‹æˆ–æ ‡é‡ç±»å‹ï¼Œç»„æˆä¸€ä¸ªæ ‘å½¢çš„ç»“æ„ï¼Œè€Œç”¨æˆ·åœ¨å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œæ²¿ç€è¿™ä¸ªæ ‘é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†æ”¯å°±å¯ä»¥è·å–å¤šç»„ä¿¡æ¯ã€‚
æ³¨æ„ï¼šåœ¨ Query æŸ¥è¯¢å­—æ®µæ—¶ï¼Œæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œè€Œåœ¨ Mutation å˜æ›´çš„æ—¶å€™ï¼Œæ˜¯çº¿æ€§æ‰§è¡Œï¼Œä¸€ä¸ªæ¥ç€ä¸€ä¸ªï¼Œé˜²æ­¢åŒæ—¶å˜æ›´å¸¦æ¥çš„ç«æ€é—®é¢˜ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å‘é€äº†ä¸¤ä¸ª Mutationï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªå°†å§‹ç»ˆåœ¨åä¸€ä¸ªä¹‹å‰æ‰§è¡Œã€‚

4. è§£æå‡½æ•° Resolver

å‰ç«¯è¯·æ±‚ä¿¡æ¯åˆ°è¾¾åç«¯ä¹‹åï¼Œéœ€è¦ç”±è§£æå‡½æ•° Resolver æ¥æä¾›æ•°æ®ï¼Œæ¯”å¦‚è¿™æ ·ä¸€ä¸ª Query

è§£æå‡½æ•°æ¥å—å››ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º

parentï¼šå½“å‰ä¸Šä¸€ä¸ªè§£æå‡½æ•°çš„è¿”å›å€¼
argsï¼šæŸ¥è¯¢ä¸­ä¼ å…¥çš„å‚æ•°
contextï¼šæä¾›ç»™æ‰€æœ‰è§£æå™¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
infoï¼šä¸€ä¸ªä¿å­˜ä¸å½“å‰æŸ¥è¯¢ç›¸å…³çš„å­—æ®µç‰¹å®šä¿¡æ¯ä»¥åŠ schema è¯¦ç»†ä¿¡æ¯çš„å€¼

5. è¯·æ±‚æ ¼å¼

GraphQL æœ€å¸¸è§çš„æ˜¯é€šè¿‡ HTTP æ¥å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆå¦‚ä½•é€šè¿‡ HTTP æ¥è¿›è¡Œ GraphQL é€šä¿¡å‘¢
Get æ˜¯å°†è¯·æ±‚å†…å®¹æ”¾åœ¨ URL ä¸­ï¼ŒPost æ˜¯åœ¨ content-type: application/json æƒ…å†µä¸‹ï¼Œå°† JSON æ ¼å¼çš„å†…å®¹æ”¾åœ¨è¯·æ±‚ä½“é‡Œ

- Get æ–¹å¼
http://myapi/graphql?query={me{name}}

- Post æ–¹å¼çš„è¯·æ±‚ä½“

{
  "query": "...",
  "operationName": "...",
  "variables": { "myVariable": "someValue", ... }
}

- è¿”å›æ ¼å¼

```json
# æ­£ç¡®è¿”å›
{
  "data": { ... }
}

# æ‰§è¡Œæ—¶å‘ç”Ÿé”™è¯¯
{
  "errors": [ ... ]
}
```

## æ¡ˆä¾‹å­¦ä¹ 

- å‰ç«¯å¦‚ä½•è°ƒç”¨æŸ¥è¯¢? `axios` `curl` `fecth` `REST CLIENT`
- å¸¸è§æŸ¥è¯¢ï¼Ÿ
- åŸºäº koa + Apollo å®ç°ä¸€ä¸ªåå°æœåŠ¡ï¼Ÿ
- åœºæ™¯å‡è®¾:
 1. åœ¨çº¿ä¼šè®®å®¤(ã€shareIdã€titleã€descã€whereã€startTime)
 2. æœ‰ä¸ªä¼šè®®åˆ—è¡¨é¡µ(åˆ†é¡µ)
 2. æœ‰ä¸ªè¯¦æƒ…é¡µ(3 ä¸ªæ¥å£): è·å–åˆ†äº«è¯¦æƒ…ã€è·å–åˆ†äº«çš„è¯„è®ºåˆ—è¡¨ã€è·å–åˆ†äº«è€…æ‰€æœ‰çš„åˆ†äº«åˆ—è¡¨
- åœºæ™¯å‡è®¾:
	ä¾‹å¦‚ï¼Œå‡è®¾ä½ è¦å±•ç¤ºä¸€ä¸ªæ–‡ç« ï¼ˆpostsï¼‰åˆ—è¡¨ï¼Œåœ¨æ¯ç¯‡æ–‡ç« çš„ä¸‹é¢æ˜¾ç¤ºå–œæ¬¢è¿™ç¯‡æ–‡ç« çš„ç”¨æˆ·åˆ—è¡¨ï¼ˆlikesï¼‰ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨æˆ·åå’Œç”¨æˆ·å¤´åƒã€‚è¿™ä¸ªéœ€æ±‚å¾ˆå®¹æ˜“è§£å†³ï¼Œä½ åªéœ€è¦è°ƒæ•´ä½ çš„ posts API è¯·æ±‚ï¼Œåœ¨å…¶ä¸­åµŒå…¥åŒ…æ‹¬ç”¨æˆ·å¯¹è±¡çš„ likes åˆ—è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
	ç°åœ¨æˆ‘ä»¬å†æºå…¥å¦ä¸€ç§æƒ…å†µï¼šposts æ•°æ®æ˜¯ç”± MySQL æ•°æ®åº“å­˜å‚¨çš„ï¼Œè€Œ likes æ•°æ®å´æ˜¯ç”± Redis å­˜å‚¨çš„ã€‚ç°åœ¨ä½ è¯¥æ€ä¹ˆåŠï¼ŸæŒ‰ç€è¿™ä¸ªå‰§æœ¬æƒ³ä¸€æƒ³ Facebook çš„å®¢æˆ·ç«¯æœ‰å¤šå°‘ä¸ªæ•°æ®æºå’Œ API éœ€è¦ç®¡ç†ï¼Œä½ å°±çŸ¥é“ä¸ºä»€ä¹ˆç°åœ¨è¯„ä»·å¾ˆå¥½çš„ REST API æ‰€ä½“ç°å‡ºçš„å±€é™æ€§äº†

- æœåŠ¡ç«¯ä¸€ä¸ªä¾‹å­, ç»™å‡ºæ‰€æœ‰æ ‡é‡(Int, Float, String, Boolean, ID äº”ç§)ã€Scalarã€Enum(æšä¸¾)ã€Interfaces(æ¥å£)ã€
- Query å’Œ Mutation æ˜¯ä¸¤ä¸ªå†…ç½®çš„ç‰¹æ®Šç±»å‹

## åå°åŠŸèƒ½å®ç°

## è¡¥å……çŸ¥è¯†

1. åˆ«åå¯ç”¨äºä»»ä½•å­—æ®µ, æ¯”å¦‚

```ql
query findAllShares {
  # ä¸º shares èµ·ä¸ªåˆ«å, sharesA
	sharesA: shares {
		shareId: id # ä¸º id èµ·äº†ä¸€ä¸ªåˆ«åï¼Œå« shareId
	}
}
```

2. æ¯ä¸€ä¸ªschemaæœ‰ä¸€ä¸ªæ ¹(root)queryå’Œæ ¹(root)mutation

3. GraphQLçº¦å®šï¼Œæˆ‘ä»¬éœ€è¦ä¸ºRoot Queryï¼ˆæ ¹æŸ¥è¯¢ï¼‰å’ŒRoot Mutationï¼ˆæ ¹å˜æ›´ï¼‰é‡Œé¢çš„æ¯ä¸€ä¸ªå­—æ®µæä¾›ä¸€ä¸ªresolverçš„å‡½æ•°ã€‚å¹¶åŒ…è£…æˆä¸€ä¸ªå¯¹è±¡æš´éœ²å‡ºå»

4. Introspection
  åœ¨çœŸå®çš„å¼€å‘ä¸­, æˆ‘ä»¬ä¼šåœ¨åç«¯å®šä¹‰ä¸€ç³»åˆ—çš„ query, mutation, input, type, enum, scalar, interface. è€Œ GraphQL æ”¯æŒä¸€å¥—å¼ºå¤§çš„å†…çœç³»ç»Ÿ, é€šè¿‡å†…çœç³»ç»Ÿ, æˆ‘ä»¬å¯ä»¥åæŸ¥åç«¯è®¾è®¡çš„ schema çš„é›†åˆ. å†…çœç³»ç»Ÿçš„å¦ä¸€ä¸ªåŠŸèƒ½åˆ™æ˜¯è¾…åŠ©å¼€å‘ GraphQL å·¥å…·, é€šè¿‡æŸ¥è¯¢å‡ºæ¥çš„å†…éƒ¨ schema, å¯ä»¥æ­å»ºå‡ºå¼ºå¤§çš„ IDE. å¦‚ä¸‹ä»£ç å¯ä»¥æŸ¥è¯¢å‡º PostItemModel è¿™ä¸ªç±»å‹çš„æ‰€æœ‰ä¿¡æ¯

5. å®‰å…¨

- ç”Ÿäº§ç¯å¢ƒå…³é—­ debugï¼Œ å¦‚æœå¼€å¯ debug æ¨¡å¼, åœ¨å‡ºé”™æ—¶ä¼šå±•ç¤ºé”™è¯¯çš„å †æ ˆä¿¡æ¯.
- ç”Ÿäº§ç¯å¢ƒå…³é—­ playgroundï¼Œplayground åº”å½“ä½œä¸ºä¸€ç§è¾…åŠ©è‡ªæµ‹å·¥å…·, å…¶ä¸åº”è¯¥æš´éœ²åˆ°çº¿ä¸Š.
- ç”Ÿäº§ç¯å¢ƒå…³é—­ introspectionï¼Œ å¾—ç›Šäºè‡ªçœ, å¯ä»¥è½»æ¾è·å–åˆ° GraphQL server å†…éƒ¨çš„ä¿¡æ¯, å¦‚å„ç§ç±»å‹, æ ‡é‡ç­‰. è¿™äº›ä¿¡æ¯ä¸åº”è¯¥åœ¨çº¿ä¸Šè¢«ä¸‰æ–¹ç›´æ¥é€šè¿‡ä»£ç é‡‡é›†åˆ°.
- æ§åˆ¶å¤šå±‚æ·±åº¦çš„æŸ¥è¯¢: å¦‚ä¸‹å¯èƒ½ä¼šé€ æˆæ˜‚è´µçš„æŸ¥è¯¢, é‡åˆ™å¯¼è‡´åç«¯å´©æºƒ. å¯ä»¥ä½¿ç”¨ graphql-depth-limit æ¥æŒ‡å®šæœ€å¤šæŸ¥è¯¢çš„å±‚çº§.
- æ§åˆ¶åˆ†é¡µæ•°æ®é‡: å¦‚ä¸‹æœ€å¤šä¸€æ¬¡å°†èƒ½è·å–åä¸‡æ¡æ•°æ®, æ˜¾è€Œæ˜“è§ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜. ä½ å¯ä»¥é€šè¿‡ graphql-input-number åœ¨ resolver ä¸­é™åˆ¶æ•°å­—çš„æœ€å¤§å€¼

6. substription è®¢é˜…ï¼šå½“æ•°æ®å‘ç”Ÿæ›´æ”¹ï¼Œè¿›è¡Œæ¶ˆæ¯æ¨é€

> https://www.apollographql.com/docs/apollo-server/v2/features/subscriptions.html#subscription-filters

```js
# src/schema.graphql

# Subscription å…¥å£
type Subscription {
    subsUser(id: ID!): User
}

type User {
    id: ID!
    name: String!
    age: Int
    email: String!
}
```

```js
// src/resolvers/index.js
import Db from '../db'
const { PubSub, withFilter } = require('apollo-server')
const pubsub = new PubSub()
const USER_UPDATE_CHANNEL = 'USER_UPDATE'

export default {
    Mutation: {
        updateUser: (parent, { id, name, email, age }) => Db.user({ id })
            .then(existUser => {
                if (!existUser)
                    throw new Error('æ²¡æœ‰è¿™ä¸ªidçš„äºº')
                return existUser
            })
            .then(() => Db.updateUser({ id, name, email, age }))
            .then(user => {
                pubsub.publish(USER_UPDATE_CHANNEL, { subsUser: user })
                return user
            })
    },
    Subscription: {
        subsUser: {
            subscribe: withFilter(
                (parent, { id }) => pubsub.asyncIterator(USER_UPDATE_CHANNEL),
                (payload, variables) => payload.subsUser.id === variables.id
            ),
            resolve: (payload, variables) => {
                console.log('ğŸš¢ æ¥æ”¶åˆ°æ•°æ®ï¼š ', payload)
            }
        }
    }
}
```

## å‚è€ƒ

- https://juejin.cn/post/6844903811006332935#heading-10
- https://juejin.cn/post/7012133339037450271
- [GraphQL ä»å…¥é—¨åˆ°å®è·µ](https://juejin.cn/post/6844903795407716366#comment)
- [æˆ‘ç»å¸¸å¬åˆ°çš„ GraphQL åˆ°åº•æ˜¯ä»€ä¹ˆ](https://juejin.cn/post/6844903475420069902)

